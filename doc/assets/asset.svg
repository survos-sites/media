<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: workflow Pages: 1 -->
<svg width="796pt" height="1408pt"
 viewBox="0.00 0.00 795.80 1408.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1404)">
<title>workflow</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1404 791.8,-1404 791.8,4 -4,4"/>
<text text-anchor="start" x="372.9" y="-8.8" font-family="Times,serif" font-weight="bold" font-size="14.00">asset</text>
<!-- place_new -->
<g id="node1" class="node">
<title>place_new</title>
<ellipse fill="lightgreen" stroke="lightBlue" cx="612" cy="-1355" rx="72" ry="36"/>
<text text-anchor="start" x="604" y="-1365.6" font-family="Arial" font-weight="bold" font-size="8.00">new</text>
<text text-anchor="start" x="580" y="-1357.6" font-family="Arial" font-style="italic" font-size="8.00">Registered/added</text>
<text text-anchor="start" x="581" y="-1341.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="605" y="-1341.6" font-family="Arial" text-decoration="underline" font-size="8.00">download</text>
<text text-anchor="start" x="640" y="-1341.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="519" y="-1393.6" font-family="Arial" font-size="8.00">Place new: </text>
</g>
<!-- transition_download -->
<g id="node9" class="node">
<title>transition_download</title>
<polygon fill="lightBlue" stroke="lightBlue" points="684,-1283 540,-1283 540,-1211 684,-1211 684,-1283"/>
<text text-anchor="start" x="592" y="-1261.6" font-family="Arial" font-weight="bold" font-size="8.00">download</text>
<text text-anchor="start" x="593.5" y="-1253.6" font-family="Arial" font-style="italic" font-size="8.00">Download</text>
<text text-anchor="start" x="599.5" y="-1245.6" font-family="Arial" font-size="8.00">async: </text>
<text text-anchor="start" x="569.5" y="-1229.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="593.5" y="-1229.6" font-family="Arial" text-decoration="underline" font-size="8.00">download_failed</text>
<text text-anchor="start" x="651.5" y="-1229.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="400" y="-1285.6" font-family="Arial" font-size="8.00">Transition download: HTTP GET/stream to temp; detect MIME; set statusCode</text>
</g>
<!-- place_new&#45;&gt;transition_download -->
<!-- new -->
<g id="edge1" class="edge">
<title>place_new&#45;&gt;transition_download</title>
<path fill="none" stroke="#333333" d="M612,-1319C612,-1309.24 612,-1298.56 612,-1288.51"/>
<polygon fill="#333333" stroke="#333333" points="613.75,-1288.33 612,-1283.33 610.25,-1288.33 613.75,-1288.33"/>
</g>
<!-- place_downloaded -->
<g id="node2" class="node">
<title>place_downloaded</title>
<ellipse fill="lightgreen" stroke="lightBlue" cx="612" cy="-1139" rx="81.84" ry="36"/>
<text text-anchor="start" x="587.5" y="-1141.6" font-family="Arial" font-weight="bold" font-size="8.00">downloaded</text>
<text text-anchor="start" x="543" y="-1133.6" font-family="Arial" font-style="italic" font-size="8.00">Fetched to temp; MIME sniffed/probed</text>
<text text-anchor="middle" x="495.33" y="-1177.6" font-family="Arial" font-size="8.00">Place downloaded: </text>
</g>
<!-- place_downloaded&#45;&gt;transition_download -->
<!-- downloaded -->
<g id="edge3" class="edge">
<title>place_downloaded&#45;&gt;transition_download</title>
<path fill="none" stroke="#333333" d="M618.39,-1174.97C618.8,-1184.82 618.86,-1195.62 618.57,-1205.76"/>
<polygon fill="#333333" stroke="#333333" points="616.82,-1205.94 618.39,-1211 620.31,-1206.06 616.82,-1205.94"/>
</g>
<!-- transition_download_failed -->
<g id="node10" class="node">
<title>transition_download_failed</title>
<polygon fill="lightBlue" stroke="lightBlue" points="770,-1067 626,-1067 626,-995 770,-995 770,-1067"/>
<text text-anchor="start" x="665" y="-1033.6" font-family="Arial" font-weight="bold" font-size="8.00">download_failed</text>
<text text-anchor="start" x="669" y="-1025.6" font-family="Arial" font-style="italic" font-size="8.00">Download failed</text>
<text text-anchor="middle" x="489" y="-1069.6" font-family="Arial" font-size="8.00">Transition download_failed: Non&#45;200 or I/O error; may be retried with backoff</text>
</g>
<!-- place_downloaded&#45;&gt;transition_download_failed -->
<!-- downloaded -->
<g id="edge7" class="edge">
<title>place_downloaded&#45;&gt;transition_download_failed</title>
<path fill="none" stroke="#333333" d="M638.97,-1104.75C647.57,-1094.15 657.17,-1082.32 666.08,-1071.34"/>
<polygon fill="#333333" stroke="#333333" points="667.54,-1072.32 669.34,-1067.33 664.83,-1070.11 667.54,-1072.32"/>
</g>
<!-- transition_invalid_file -->
<g id="node11" class="node">
<title>transition_invalid_file</title>
<polygon fill="lightBlue" stroke="lightBlue" points="608,-1067 464,-1067 464,-995 608,-995 608,-1067"/>
<text text-anchor="start" x="514.5" y="-1033.6" font-family="Arial" font-weight="bold" font-size="8.00">invalid_file</text>
<text text-anchor="start" x="518.5" y="-1025.6" font-family="Arial" font-style="italic" font-size="8.00">Invalid file</text>
<text text-anchor="middle" x="346.5" y="-988.6" font-family="Arial" font-size="8.00">Transition invalid_file: Unsupported media type or invalid attributes</text>
</g>
<!-- place_downloaded&#45;&gt;transition_invalid_file -->
<!-- downloaded -->
<g id="edge9" class="edge">
<title>place_downloaded&#45;&gt;transition_invalid_file</title>
<path fill="none" stroke="#333333" d="M587.95,-1104.46C580.43,-1093.97 572.06,-1082.29 564.27,-1071.43"/>
<polygon fill="#333333" stroke="#333333" points="565.54,-1070.19 561.2,-1067.15 562.69,-1072.23 565.54,-1070.19"/>
</g>
<!-- transition_analyze -->
<g id="node12" class="node">
<title>transition_analyze</title>
<polygon fill="lightBlue" stroke="lightBlue" points="446,-1067 302,-1067 302,-995 446,-995 446,-1067"/>
<text text-anchor="start" x="359" y="-1045.6" font-family="Arial" font-weight="bold" font-size="8.00">analyze</text>
<text text-anchor="start" x="360" y="-1037.6" font-family="Arial" font-style="italic" font-size="8.00">Analyze</text>
<text text-anchor="start" x="361.5" y="-1029.6" font-family="Arial" font-size="8.00">async: </text>
<text text-anchor="start" x="347.5" y="-1013.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="371.5" y="-1013.6" font-family="Arial" text-decoration="underline" font-size="8.00">archive</text>
<text text-anchor="start" x="397.5" y="-1013.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="151" y="-1069.6" font-family="Arial" font-size="8.00">Transition analyze: Compute blurhash/thumbhash, color palette, pHash, media probe</text>
</g>
<!-- place_downloaded&#45;&gt;transition_analyze -->
<!-- downloaded -->
<g id="edge11" class="edge">
<title>place_downloaded&#45;&gt;transition_analyze</title>
<path fill="none" stroke="#333333" d="M555.6,-1112.88C524.42,-1098.99 485.22,-1081.53 451.23,-1066.39"/>
<polygon fill="#333333" stroke="#333333" points="451.53,-1064.61 446.25,-1064.18 450.11,-1067.81 451.53,-1064.61"/>
</g>
<!-- place_analyzed -->
<g id="node3" class="node">
<title>place_analyzed</title>
<ellipse fill="lightgreen" stroke="lightBlue" cx="374" cy="-923" rx="120.04" ry="36"/>
<text text-anchor="start" x="356.5" y="-933.6" font-family="Arial" font-weight="bold" font-size="8.00">analyzed</text>
<text text-anchor="start" x="282" y="-925.6" font-family="Arial" font-style="italic" font-size="8.00">Features computed (blurhash/palette/pHash/probe)</text>
<text text-anchor="start" x="347.5" y="-909.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="371.5" y="-909.6" font-family="Arial" text-decoration="underline" font-size="8.00">archive</text>
<text text-anchor="start" x="397.5" y="-909.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="224.73" y="-961.6" font-family="Arial" font-size="8.00">Place analyzed: </text>
</g>
<!-- transition_archive -->
<g id="node13" class="node">
<title>transition_archive</title>
<polygon fill="lightBlue" stroke="lightBlue" points="446,-851 302,-851 302,-779 446,-779 446,-851"/>
<text text-anchor="start" x="359.5" y="-829.6" font-family="Arial" font-weight="bold" font-size="8.00">archive</text>
<text text-anchor="start" x="346.5" y="-821.6" font-family="Arial" font-style="italic" font-size="8.00">Archive original</text>
<text text-anchor="start" x="361.5" y="-813.6" font-family="Arial" font-size="8.00">async: </text>
<text text-anchor="start" x="333" y="-797.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="357" y="-797.6" font-family="Arial" text-decoration="underline" font-size="8.00">queue_variants</text>
<text text-anchor="start" x="412" y="-797.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="166.5" y="-853.6" font-family="Arial" font-size="8.00">Transition archive: Write original to long&#45;term storage with analysis metadata</text>
</g>
<!-- place_analyzed&#45;&gt;transition_archive -->
<!-- analyzed -->
<g id="edge13" class="edge">
<title>place_analyzed&#45;&gt;transition_archive</title>
<path fill="none" stroke="#333333" d="M374,-887C374,-877.24 374,-866.56 374,-856.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-856.33 374,-851.33 372.25,-856.33 375.75,-856.33"/>
</g>
<!-- place_archived -->
<g id="node4" class="node">
<title>place_archived</title>
<ellipse fill="lightgreen" stroke="lightBlue" cx="374" cy="-707" rx="89.7" ry="36"/>
<text text-anchor="start" x="357" y="-717.6" font-family="Arial" font-weight="bold" font-size="8.00">archived</text>
<text text-anchor="start" x="307.5" y="-709.6" font-family="Arial" font-style="italic" font-size="8.00">Original stored durably with metadata</text>
<text text-anchor="start" x="333" y="-693.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="357" y="-693.6" font-family="Arial" text-decoration="underline" font-size="8.00">queue_variants</text>
<text text-anchor="start" x="412" y="-693.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="255.9" y="-745.6" font-family="Arial" font-size="8.00">Place archived: </text>
</g>
<!-- transition_queue_variants -->
<g id="node14" class="node">
<title>transition_queue_variants</title>
<polygon fill="lightBlue" stroke="lightBlue" points="446,-635 302,-635 302,-563 446,-563 446,-635"/>
<text text-anchor="start" x="343.5" y="-609.6" font-family="Arial" font-weight="bold" font-size="8.00">queue_variants</text>
<text text-anchor="start" x="346.5" y="-601.6" font-family="Arial" font-style="italic" font-size="8.00">Queue variants</text>
<text text-anchor="start" x="334.5" y="-585.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="358.5" y="-585.6" font-family="Arial" text-decoration="underline" font-size="8.00">await_variants</text>
<text text-anchor="start" x="410.5" y="-585.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="161" y="-637.6" font-family="Arial" font-size="8.00">Transition queue_variants: Select presets per media type; enqueue Variant jobs</text>
</g>
<!-- place_archived&#45;&gt;transition_queue_variants -->
<!-- archived -->
<g id="edge15" class="edge">
<title>place_archived&#45;&gt;transition_queue_variants</title>
<path fill="none" stroke="#333333" d="M374,-671C374,-661.24 374,-650.56 374,-640.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-640.33 374,-635.33 372.25,-640.33 375.75,-640.33"/>
</g>
<!-- place_variants_queued -->
<g id="node5" class="node">
<title>place_variants_queued</title>
<ellipse fill="lightgreen" stroke="lightBlue" cx="374" cy="-491" rx="72" ry="36"/>
<text text-anchor="start" x="340.5" y="-501.6" font-family="Arial" font-weight="bold" font-size="8.00">variants_queued</text>
<text text-anchor="start" x="333.5" y="-493.6" font-family="Arial" font-style="italic" font-size="8.00">Variant jobs enqueued</text>
<text text-anchor="start" x="334.5" y="-477.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="358.5" y="-477.6" font-family="Arial" text-decoration="underline" font-size="8.00">await_variants</text>
<text text-anchor="start" x="410.5" y="-477.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="259" y="-529.6" font-family="Arial" font-size="8.00">Place variants_queued: </text>
</g>
<!-- transition_await_variants -->
<g id="node15" class="node">
<title>transition_await_variants</title>
<polygon fill="lightBlue" stroke="lightBlue" points="446,-419 302,-419 302,-347 446,-347 446,-419"/>
<text text-anchor="start" x="345.5" y="-397.6" font-family="Arial" font-weight="bold" font-size="8.00">await_variants</text>
<text text-anchor="start" x="349" y="-389.6" font-family="Arial" font-style="italic" font-size="8.00">Await variants</text>
<text text-anchor="start" x="361.5" y="-381.6" font-family="Arial" font-size="8.00">async: </text>
<text text-anchor="start" x="348" y="-365.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="372" y="-365.6" font-family="Arial" text-decoration="underline" font-size="8.00">finalize</text>
<text text-anchor="start" x="397" y="-365.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="184.5" y="-421.6" font-family="Arial" font-size="8.00">Transition await_variants: Fan&#45;in when all Variant jobs report done</text>
</g>
<!-- place_variants_queued&#45;&gt;transition_await_variants -->
<!-- variants_queued -->
<g id="edge17" class="edge">
<title>place_variants_queued&#45;&gt;transition_await_variants</title>
<path fill="none" stroke="#333333" d="M374,-455C374,-445.24 374,-434.56 374,-424.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-424.33 374,-419.33 372.25,-424.33 375.75,-424.33"/>
</g>
<!-- place_variants_built -->
<g id="node6" class="node">
<title>place_variants_built</title>
<ellipse fill="lightgreen" stroke="lightBlue" cx="374" cy="-275" rx="72" ry="36"/>
<text text-anchor="start" x="346.5" y="-285.6" font-family="Arial" font-weight="bold" font-size="8.00">variants_built</text>
<text text-anchor="start" x="340" y="-277.6" font-family="Arial" font-style="italic" font-size="8.00">All variants finished</text>
<text text-anchor="start" x="348" y="-261.6" font-family="Arial" font-size="8.00">Then: </text>
<text text-anchor="start" x="372" y="-261.6" font-family="Arial" text-decoration="underline" font-size="8.00">finalize</text>
<text text-anchor="start" x="397" y="-261.6" font-family="Arial" font-size="8.00"> </text>
<text text-anchor="middle" x="265.5" y="-313.6" font-family="Arial" font-size="8.00">Place variants_built: </text>
</g>
<!-- transition_finalize -->
<g id="node16" class="node">
<title>transition_finalize</title>
<polygon fill="lightBlue" stroke="lightBlue" points="446,-203 302,-203 302,-131 446,-131 446,-203"/>
<text text-anchor="start" x="360" y="-169.6" font-family="Arial" font-weight="bold" font-size="8.00">finalize</text>
<text text-anchor="start" x="360" y="-161.6" font-family="Arial" font-style="italic" font-size="8.00">Finalize</text>
<text text-anchor="middle" x="208.5" y="-205.6" font-family="Arial" font-size="8.00">Transition finalize: Webhooks, indexing, bookkeeping</text>
</g>
<!-- place_variants_built&#45;&gt;transition_finalize -->
<!-- variants_built -->
<g id="edge19" class="edge">
<title>place_variants_built&#45;&gt;transition_finalize</title>
<path fill="none" stroke="#333333" d="M374,-239C374,-229.24 374,-218.56 374,-208.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-208.33 374,-203.33 372.25,-208.33 375.75,-208.33"/>
</g>
<!-- place_complete -->
<g id="node7" class="node">
<title>place_complete</title>
<ellipse fill="lightgreen" stroke="lightBlue" cx="374" cy="-59" rx="72" ry="36"/>
<text text-anchor="start" x="355.5" y="-61.6" font-family="Arial" font-weight="bold" font-size="8.00">complete</text>
<text text-anchor="start" x="359.5" y="-53.6" font-family="Arial" font-style="italic" font-size="8.00">All done</text>
<text text-anchor="middle" x="272.5" y="-97.6" font-family="Arial" font-size="8.00">Place complete: </text>
</g>
<!-- place_failed -->
<g id="node8" class="node">
<title>place_failed</title>
<ellipse fill="lightgreen" stroke="lightBlue" cx="698" cy="-923" rx="72.25" ry="36"/>
<text text-anchor="start" x="687" y="-925.6" font-family="Arial" font-weight="bold" font-size="8.00">failed</text>
<text text-anchor="start" x="638" y="-917.6" font-family="Arial" font-style="italic" font-size="8.00">Terminal error / exhausted retries</text>
<text text-anchor="middle" x="602.88" y="-961.6" font-family="Arial" font-size="8.00">Place failed: </text>
</g>
<!-- place_failed&#45;&gt;transition_download -->
<!-- failed -->
<g id="edge5" class="edge">
<title>place_failed&#45;&gt;transition_download</title>
<path fill="none" stroke="#333333" d="M742.55,-951.65C756.95,-963.12 771.2,-977.8 779,-995 792.21,-1024.15 788.66,-1036.49 779,-1067 760.37,-1125.84 709.15,-1175.52 668.3,-1207.5"/>
<polygon fill="#333333" stroke="#333333" points="666.76,-1206.48 663.87,-1210.93 668.9,-1209.25 666.76,-1206.48"/>
</g>
<!-- transition_download&#45;&gt;place_downloaded -->
<g id="edge2" class="edge">
<title>transition_download&#45;&gt;place_downloaded</title>
<path fill="none" stroke="#333333" d="M605.61,-1211C605.2,-1201.14 605.14,-1190.34 605.43,-1180.2"/>
<polygon fill="#333333" stroke="#333333" points="607.19,-1180.02 605.61,-1174.97 603.69,-1179.9 607.19,-1180.02"/>
</g>
<!-- transition_download&#45;&gt;place_downloaded -->
<g id="edge4" class="edge">
<title>transition_download&#45;&gt;place_downloaded</title>
<path fill="none" stroke="#333333" d="M618.39,-1211C618.8,-1201.14 618.86,-1190.34 618.57,-1180.2"/>
<polygon fill="#333333" stroke="#333333" points="620.31,-1179.9 618.39,-1174.97 616.81,-1180.02 620.31,-1179.9"/>
</g>
<!-- transition_download&#45;&gt;place_downloaded -->
<g id="edge6" class="edge">
<title>transition_download&#45;&gt;place_downloaded</title>
<path fill="none" stroke="#333333" d="M605.61,-1211C605.2,-1201.14 605.14,-1190.34 605.43,-1180.2"/>
<polygon fill="#333333" stroke="#333333" points="607.19,-1180.02 605.61,-1174.97 603.69,-1179.9 607.19,-1180.02"/>
</g>
<!-- transition_download_failed&#45;&gt;place_failed -->
<g id="edge8" class="edge">
<title>transition_download_failed&#45;&gt;place_failed</title>
<path fill="none" stroke="#333333" d="M698,-995C698,-985.24 698,-974.56 698,-964.51"/>
<polygon fill="#333333" stroke="#333333" points="699.75,-964.33 698,-959.33 696.25,-964.33 699.75,-964.33"/>
</g>
<!-- transition_invalid_file&#45;&gt;place_failed -->
<g id="edge10" class="edge">
<title>transition_invalid_file&#45;&gt;place_failed</title>
<path fill="none" stroke="#333333" d="M589.49,-995C609.29,-982.05 631.57,-967.47 650.76,-954.91"/>
<polygon fill="#333333" stroke="#333333" points="651.84,-956.3 655.06,-952.09 649.92,-953.37 651.84,-956.3"/>
</g>
<!-- transition_analyze&#45;&gt;place_analyzed -->
<g id="edge12" class="edge">
<title>transition_analyze&#45;&gt;place_analyzed</title>
<path fill="none" stroke="#333333" d="M374,-995C374,-985.24 374,-974.56 374,-964.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-964.33 374,-959.33 372.25,-964.33 375.75,-964.33"/>
</g>
<!-- transition_archive&#45;&gt;place_archived -->
<g id="edge14" class="edge">
<title>transition_archive&#45;&gt;place_archived</title>
<path fill="none" stroke="#333333" d="M374,-779C374,-769.24 374,-758.56 374,-748.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-748.33 374,-743.33 372.25,-748.33 375.75,-748.33"/>
</g>
<!-- transition_queue_variants&#45;&gt;place_variants_queued -->
<g id="edge16" class="edge">
<title>transition_queue_variants&#45;&gt;place_variants_queued</title>
<path fill="none" stroke="#333333" d="M374,-563C374,-553.24 374,-542.56 374,-532.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-532.33 374,-527.33 372.25,-532.33 375.75,-532.33"/>
</g>
<!-- transition_await_variants&#45;&gt;place_variants_built -->
<g id="edge18" class="edge">
<title>transition_await_variants&#45;&gt;place_variants_built</title>
<path fill="none" stroke="#333333" d="M374,-347C374,-337.24 374,-326.56 374,-316.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-316.33 374,-311.33 372.25,-316.33 375.75,-316.33"/>
</g>
<!-- transition_finalize&#45;&gt;place_complete -->
<g id="edge20" class="edge">
<title>transition_finalize&#45;&gt;place_complete</title>
<path fill="none" stroke="#333333" d="M374,-131C374,-121.24 374,-110.56 374,-100.51"/>
<polygon fill="#333333" stroke="#333333" points="375.75,-100.33 374,-95.33 372.25,-100.33 375.75,-100.33"/>
</g>
</g>
</svg>
